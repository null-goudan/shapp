<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>同学助校园顺手捎网-个人中心</title>
    <link rel="stylesheet" href="{% static '/lib/layui-v2.6.3/css/layui.css' %}">
    <script src="{% static '/lib/layui-v2.6.3/layui.js' %}"></script>
    <link rel="stylesheet"   href="{% static '/css/index.css' %}"/>
    <script src="{% static '/lib/jquery-3.4.1/jquery-3.4.1.min.js' %}"></script>
</head>
<body>
    <header>
        <div class="log">同学助校园顺手捎网</div>
        <nav>
          <a href="/">首页</a>
          <a href="/#showcases">在线接单</a>
          <a href="/take">在线下单</a>
          <a href="/user/information">个人中心</a>
          <a href="/user/houtai_login">后台登录</a>
          <a href="#"><i class="fas fa-search"></i></a> 
        </nav>
        <div class="burger">
          <div class="burger-line1"></div>
          <div class="burger-line2"></div>
          <div class="burger-line3"></div>
        </div>
      </header>
       
    
       <div style="width: 100%; background-color: #dddde1;">
          
        <div id="content" style="margin:10px auto 0 auto; width: 1280px;">
            
            
        <div class="layui-row layui-col-space15 " >
            <!-- 左侧栏 -->
        <div id="content-left"class="layui-col-md3" style="margin-top: 25px;" >

           
                 <h1 style="font-size: 20px;height: 50px; background-color: #393d49; color: white;"> <strong style="font-size: 30px;">个</strong>人中心</h1>
             <ul class="layui-nav layui-nav-tree "lay-filter="test" style="width: 100%;margin-bottom: 20px;">
  
                   
                  <li class="layui-nav-item " ><a href="/user/information" style="width:268px; ">我的信息</a></li>
                  
                  <li class="layui-nav-item layui-nav-itemed" style="background-color: #4E5465;">
                    <a href="/user/send" style="width: 268px;">我发出的</a>
                </li>
                  <li class="layui-nav-item"><a href="/user/help" style="width: 268px;">我帮助的</a></li>
                  <li class="layui-nav-item"><a href="" style="width: 268px;">我的积分</a></li>
                  <li class="layui-nav-item" ><a href="/user/password" style="width: 268px;">修改密码</a></li>
                </ul>
        
            
<!--             
                <div class="bulletin" style="background-color: white;">
                    <h2 >&nbsp &nbsp &nbsp系统公告</h2>
                    <p> 欢迎登录窝嫩叠顺手捎网站!</p>
                </div> -->
                

            
      </div>
      
         <!-- 右侧栏 -->
          <div class="layui-col-md9" id="fabu" style="background-color: white;   border:1px solid #cccccc; margin: 30px 0; padding: 0;">
            
            <!-- 搜索框 -->
            <fieldset class="table-search-fieldset">
                <legend>搜索信息</legend>
                <div style="margin: 10px 10px 10px 10px">
                    <form class="layui-form layui-form-pane" action="">
                        <div class="layui-form-item">
    
    
                            <div class="layui-inline">
                                <label class="layui-form-label">分类</label>
                                <div class="layui-input-inline">
                                    <select name="classify" lay-filter="">
                                        <option value="">请选择</option>
                                        <option value="take" >帮我取</option>
                                        <option value="buy" >帮我买</option>
                                        <option value="do" >帮我做</option>
                                    </select>
                                </div>
                            </div>
                             
                            <div class="layui-inline">
                                <label class="layui-form-label">状态</label>
                                <div class="layui-input-inline">
                                    <select name="state" lay-filter="">
                                        <option value="">请选择</option>
                                        <option value="take" >待完成</option>
                                        <option value="buy" >完成中</option>
                                        <option value="do" >已完成</option>
                                    </select>
                                </div>
                            </div>
        
    
                           
                            <div class="layui-inline">
                                <button type="submit" class="layui-btn layui-btn-primary"  lay-submit lay-filter="data-search-btn"> 搜 索</button>
                            </div>
                        </div>
                    </form>
                    
                </div>
            </fieldset>

            <!-- 表格 -->
            <table class="layui-hide" id="currentTableId" lay-filter="currentTableFilter"></table>
           
            <!-- 编辑查看表单 -->
            <div class="xiugai layui-form layuimini-form" hidden="hidden">
    
                <form class="layui-form layui-form-pane" action="">
                    <div class="layui-form-item">
                    <label class="layui-form-label">标题</label>
                    <div class="layui-input-block">
                        <input type="text" name="title" lay-verify="title" id="title" autocomplete="off" placeholder="请输入标题"  class="layui-input">
                    </div>
                </div>
                
                <div class="layui-form-item">
                <label class="layui-form-label">分类</label>
                <div class="layui-input-block">
                    <input type="text" name="classify"  id="classify" lay-verify="required" autocomplete="off" placeholder="" class="layui-input">
            
                </input>
                </div>
                </div>
            
                <div class="layui-form-item">
                    <label class="layui-form-label">取货名称</label>
                    <div class="layui-input-block">
                        <input type="text" name="goods"  id="goods" lay-verify="required" autocomplete="off" placeholder="请输入名称" class="layui-input">
                    </div>
                </div>
            
                <div class="layui-form-item">
                    <label class="layui-form-label">取货地址</label>
                    <div class="layui-input-block">
                        <input type="text" name="get-address" id="get_address" lay-verify="required" autocomplete="off" placeholder="请输入取货地址" class="layui-input">
                    </div>
                </div>
            
                <div class="layui-form-item">
                    <label class="layui-form-label">收货地址</label>
                    <div class="layui-input-block">
                        <input type="text" name="home_address" id="home_address"lay-verify="required" autocomplete="off" placeholder="请输入收货地址" class="layui-input">
                    </div>
                </div>
                
                <div class="layui-form-item">
                    <label class="layui-form-label">联系电话</label>
                    <div class="layui-input-block">
                        <input type="tel" name="phone" id="phone" lay-verify="required|phone" autocomplete="off" placeholder="请输入电话" class="layui-input">
                    </div>
                </div>
                
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">时间</label>
                        <div class="layui-input-inline" style="width: 200px;">
                            <input type="text" id="date1" name="date_start" lay-verify="required" placeholder="开始时间" autocomplete="off" class="layui-input" >
                        </div>
                        <div class="layui-form-mid">-</div>
                        <div class="layui-input-inline" style="width: 200px;">
                            <input type="text" id="date2" name="date_ending" lay-verify="required" placeholder="截止时间" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                </div>
            
                <div class="layui-form-item">
                    <label class="layui-form-label">奖励</label>
                    <div class="layui-input-block">
                        <input type="text" id="reward" name="reward" lay-verify="required"  autocomplete="off" placeholder="" class="layui-input">
                    </div>
                </div>
            
                <div class="layui-form-item layui-form-text">
                    <label class="layui-form-label">详细描述</label>
                    <div class="layui-input-block">
                        <textarea id="describe" name="describe" placeholder="请输入内容" class="layui-textarea"></textarea>
                    </div>
                </div>
            
            </form>
            
                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button class="layui-btn layui-btn-normal" lay-submit lay-filter="saveBtn">确认修改</button>
                    </div>
                </div>
            </div>
    
            <script type="text/html" id="currentTableBar">
                <a class="layui-btn layui-btn-normal layui-btn-xs data-count-edit" lay-event="edit">查看编辑</a>
                <a class="layui-btn layui-btn-xs layui-btn-danger data-count-delete" lay-event="delete">删除订单</a>
                <a class="layui-btn  layui-btn-xs data-count-edit" lay-event="edit">确认完成</a>
            </script>
                
            <script>
                layui.use(['form', 'table'], function () {
                    var $ = layui.jquery,
                        form = layui.form,
                        table = layui.table;
                    
                  //加载表单数据，单子详情接口
                    table.render({
                        elem: '#currentTableId',
                        url: '/user/send_table_info/',
                       
                        cols: [[
                            {type: "checkbox", width: 50},
                            {type: "numbers", width: 50,title: '序号'},
                            {field: 'table_id', width: 75, title: '编号', align: "center"},
                            {field: 'title', width: 150, title: '标题',align: "center"},
                            {field: 'goods', width: 100, title: '名称',align: "center"},
                            {field: 'classify', width: 90, title: '分类', sort: true,align: "center"},
                            {field: 'state', width: 90, title: '状态', sort: true,align: "center"},
                            {field: 'phone', width: 150, title: '联系电话',align: "center",hide:true},
                            {field: 'runner', width: 100, title: '接单人',align: "center"},
                            {field: 'reward', width: 100, title: '奖励', sort: true,align: "center"},
                            {field: 'date_start', width: 200, title: '接单时间', sort: true,hide:true},
                            {field: 'date_ending', width: 200, title: '截止时间', sort: true,hide:true},
                            {field: 'get_address', width: 100, title: '取货地址',align: "center",hide:true},
                            {field: 'home_address', width: 100, title: '收货地址',align: "center",hide:true},
                            {field: 'describe', width: 150, title: '详细描述', sort: true,hide:true},
                            {title: '操作', minWidth: 200, toolbar: '#currentTableBar', align: "center",align: "center"}
                                ]],
                        limits: [10, 15, 20, 25, 50, 100],
                        limit: 15,
                        page: true,
                        skin: 'line'
                    });
            
                    // 监听搜索操作
                    form.on('submit(data-search-btn)', function (data) {
                        var result = JSON.stringify(data.field);
                        layer.alert(result, {
                            title: '最终的搜索信息'
                        });
            
                        //执行搜索重载
                        table.reload('currentTableId', {
                            page: {
                                curr: 1
                            }
                            , where: {
                                searchParams: result
                            }
                        }, 'data');
            
                        return false;
                    });
            
                    /**
                     * toolbar监听事件
                     */
            
                    //监听表格复选框选择
                    table.on('checkbox(currentTableFilter)', function (obj) {
                        console.log(obj)
                    });
                    
                    //监听编辑查看
                    table.on('tool(currentTableFilter)', function (obj) {
                        var data = obj.data;
                        if (obj.event === 'edit') {
                            var index = layer.open({
                                title: '编辑查看',
                                type: 1,
                                shade: 0.2,
                                maxmin:true,
                                shadeClose: true,
                                area: ['50%', '50%'],
                                content: $('.xiugai'),
                                success:function(layero,index){
                                    $("#title").val(data.title);
                                    $("#classify").val(data.classify);
                                    $("#goods").val(data.goods);
                                    $("#get_address").val(data.get_address);
                                    $("#home_address").val(data.home_address);
                                    $("#phone").val(data.phone);
                                    $("#date1").val(data.date_start);
                                    $("#date2").val(data.date_ending);
                                    $("#reward").val(data.reward);
                                    $("#describe").val(data.describe);
                                }
                            });

                        // 修改单子接口
                            form.on('submit(saveBtn)', function (data) {
                                console.log(data.field);
                                $.ajax({
                                    url:'/user/table_update/',
                                    method:'post',
                                    data:{
                                        table_id: obj.data['table_id'],
                                        information:data.field
                                    },
                                    // type:'POST',
                                    dataType:'json',
                                    success:function(data){
                                        layer.msg('修改成功');
                                    }
                                })
                            });
                            $(window).on("resize", function () {
                                    layer.full(index);
                                });
                            return false;
                        }
                        //删除单子接口
                        else if (obj.event === 'delete') {
                            layer.confirm('确认删除该订单吗', function (index) {
                                console.log(obj.data['table_id'])
                                $.ajax({
                                    url:'/user/delete/',
                                    data:{
                                        table_id: obj.data['table_id']
                                    },
                                    type:'POST',
                                    dataType:'json',
                                    success:function(data){
                                        obj.del();
                                       layer.close(index);//关闭弹出层
                                    }
                                })                               
                            });
                        }
                         });
            
                                });
            </script>
               
            </div>
            </div>        
               
       </div>
        </div>
       </div>
      
       </div>
       
       <footer style="margin-top: 0;">
        <div class="footer-menus">
          <div class="contact-us">
            <p class="menu-title">联系我们</p>
            <p>电话：9999-999-999</p>
            <p>电子邮件：shunshoushao@163.com</p>
          </div>
          <div class="service-menu footer-menu">
            <p class="menu-title">意见反馈</p>
            <ul class="menu-items">
              <li><a href="#">常见问题</a></li>
              <li><a href="#">如何付费</a></li>
              <li><a href="#">如何下单</a></li>
            </ul>
          </div>
          <div class="service-menu footer-menu">
            <p class="menu-title">关于我们</p>
            <ul class="menu-items">
              <li><a href="#">窝嫩叠顺手捎介绍</a></li>
              <li><a href="#">合作伙伴</a></li>
            </ul>
          </div>
          <div class="service-menu footer-menu">
            <p class="menu-title">帮助与支持</p>
            <ul class="menu-items">
              <li><a href="#">帮助中心</a></li>
              <li><a href="#">联系客服</a></li>
              <li><a href="#">文档资源</a></li>
            </ul>
          </div>
          <p class="icp-info">蜀ICP备99999999号</p>
          <p class="rights">&copy; 窝嫩叠顺手捎有限公司</p>
          <div class="scroll-to-top">
            <a href="#"><i class="fas fa-chevron-up"></i></a>
          </div>
        </div>
      </footer>
     
        <script src="{% static 'lib/layui-v2.6.3/lay-config.js?v=1.0.4' %}" charset="utf-8"></script>

      <script>
      //注意：导航 依赖 element 模块，否则无法进行功能性操作
      layui.use('element', function(){
        var element = layui.element;
      });
       //时间模块
       layui.use('laydate',function(){
        var laydate=layui.laydate;

        laydate.render({
            elem:"#date1",
            type:"datetime"
        })

        laydate.render({
            elem:"#date2",
            type:"datetime"
        })
       })
    
      //修改密码
      layui.use(['form','miniTab'], function () {
        var form = layui.form,
            layer = layui.layer,
            miniTab = layui.miniTab;

      

    });
      </script>
</body>
</html>